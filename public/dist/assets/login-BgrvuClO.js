(e=>{let t=!1;const n=()=>{t||(t=!0,e())};"loading"===document.readyState?(document.addEventListener("DOMContentLoaded",n,{once:!0}),window.addEventListener("load",n,{once:!0}),window.addEventListener("pageshow",n,{once:!0})):("function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e))(n)})(()=>{const e=document.getElementById("login-form"),t=document.getElementById("error-message"),n=document.querySelector("#login-form button[type='submit']");document.getElementById("verification-code-section");const o=document.getElementById("verification-code");e&&(o&&o.addEventListener("input",function(){this.value=this.value.replace(/\D/g,"").slice(0,6)}),e.addEventListener("submit",async e=>{e.preventDefault();const i=document.getElementById("username").value,a=document.getElementById("password").value,s=o?o.value.trim():null;t.textContent="",t.style.color="#ef4444","function"==typeof setButtonLoading?setButtonLoading(n,!0,"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."):(n.disabled=!0,n.innerHTML='<span class="loading-dots" aria-hidden="true"><span></span><span></span><span></span></span><span style="margin-right:8px">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>');try{const e=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:a,verificationCode:s})}),n=await e.json();if(n.requiresVerification){const{value:e}=await Swal.fire({title:"ğŸ”‘ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø·Ù„ÙˆØ¨",html:'\n                            <p style="margin-bottom: 20px; color: #fff; font-size: 14px;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡ Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</p>\n                            <input type="text" id="swal-verification-code" class="swal2-input" \n                                   placeholder="123456" maxlength="6" pattern="[0-9]{6}" \n                                   style="text-align: center; font-size: 24px; letter-spacing: 8px; font-weight: bold; font-family: monospace; color: #ffcc00; border: 2px solid #ffcc00; max-width: 200px; width: 100%; padding: 12px;">\n                        ',icon:"info",iconColor:"#ffcc00",showCancelButton:!0,confirmButtonText:"ØªØ£ÙƒÙŠØ¯",cancelButtonText:"Ø¥Ù„ØºØ§Ø¡",confirmButtonColor:"#ffcc00",cancelButtonColor:"#666",background:"#2a1b3c",color:"#fff",backdrop:"rgba(0,0,0,0.8)",allowOutsideClick:!1,allowEscapeKey:!1,customClass:{popup:"swal2-popup-responsive",container:"swal2-container-responsive"},didOpen:()=>{const e=document.getElementById("swal-verification-code");e&&(e.focus(),e.addEventListener("input",function(){this.value=this.value.replace(/\D/g,"").slice(0,6)}))},preConfirm:()=>{const e=document.getElementById("swal-verification-code").value;return e&&6===e.length?e:(Swal.showValidationMessage("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ 6 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·"),!1)}});if(e)try{const t=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:a,verificationCode:e})}),n=await t.json();if(!t.ok||!n.success){if(n.message&&n.message.includes("ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚"))throw new Error("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ 6 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·");throw new Error(n.message||"ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­")}window.location.href=n.redirect||"/form-panel"}catch(c){t.textContent=c.message,t.style.color="#ef4444"}return}if(!e.ok||!n.success)throw new Error(n.message||"Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");window.location.href=n.redirect||"/form-panel"}catch(c){t.textContent=c.message,t.style.color="#ef4444"}finally{"function"==typeof setButtonLoading?setButtonLoading(n,!1):(n.disabled=!1,n.innerHTML="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„")}}))});